<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Drive Folder Viewer</title>
<style>
  body {
    margin: 0;
    padding: 20px;
    font-family: "Poppins", sans-serif;
    background: linear-gradient(135deg, #e0f7fa, #bbdefb);
    color: #0d47a1;
  }

  h2 {
    text-align: center;
    font-size: 24px;
    color: #0d47a1;
    font-weight: 700;
    margin-bottom: 15px;
    text-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }

  .toolbar {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 25px;
  }

  input, select, button {
    padding: 10px 14px;
    border-radius: 30px;
    border: 1px solid #90caf9;
    outline: none;
    transition: 0.3s;
    font-size: 14px;
  }

  input {
    width: 220px;
  }

  input:focus {
    box-shadow: 0 0 8px rgba(33, 150, 243, 0.4);
  }

  button {
    cursor: pointer;
    background: linear-gradient(135deg, #2196f3, #1565c0);
    color: #fff;
    border: none;
    font-weight: 600;
  }

  button:hover {
    background: linear-gradient(135deg, #1976d2, #0a369d);
  }

  .grid, .list {
    display: grid;
    gap: 16px;
    animation: fadeIn 0.6s ease;
  }

  .grid {
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  }

  .list {
    grid-template-columns: 1fr;
  }

  .file {
    background: rgba(255,255,255,0.8);
    border-radius: 18px;
    backdrop-filter: blur(8px);
    box-shadow: 0 8px 18px rgba(0,0,0,0.1);
    padding: 14px;
    text-align: center;
    transition: 0.3s;
    position: relative;
    overflow: hidden;
  }

  .file:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 25px rgba(33, 150, 243, 0.2);
  }

  .file img {
    width: 70px;
    height: 70px;
    margin-bottom: 8px;
  }

  .file h4 {
    font-size: 14px;
    margin: 5px 0;
    color: #0d47a1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .view-btn {
    background: #2196f3;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 12px;
    margin-top: 6px;
    transition: 0.3s;
  }

  .view-btn:hover {
    background: #1976d2;
  }

  .copy-btn {
    position: absolute;
    top: 8px;
    right: 10px;
    background: rgba(255,255,255,0.6);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    padding: 4px 7px;
    transition: 0.3s;
  }

  .copy-btn:hover {
    background: #bbdefb;
  }

  .loader {
    text-align: center;
    font-size: 16px;
    color: #1976d2;
    margin-top: 40px;
  }

  /* Modal */
  #pdfModal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    justify-content: center;
    align-items: center;
    z-index: 999;
  }

  .pdf-viewer {
    width: 90%;
    height: 90%;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
  }

  .pdf-viewer iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  .close-btn {
    position: absolute;
    top: 8px;
    right: 10px;
    background: #ef4444;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }

  .file-count {
    text-align: center;
    color: #333;
    font-size: 13px;
    margin-top: 5px;
  }

  @keyframes fadeIn {
    from {opacity:0; transform: translateY(10px);}
    to {opacity:1; transform: translateY(0);}
  }

  @media (max-width: 480px) {
    input { width: 160px; }
    h2 { font-size: 18px; }
  }
</style>
</head>
<body>

<h2>üìÅ Google Drive Viewer</h2>

<div class="toolbar">
  <input type="text" id="searchBox" placeholder="Search files...">
  <select id="sortSelect">
    <option value="az">A ‚Üí Z</option>
    <option value="za">Z ‚Üí A</option>
    <option value="date">Newest</option>
  </select>
  <button id="toggleViewBtn">üî≥ Grid</button>
</div>

<div id="fileContainer" class="grid"></div>
<p class="file-count" id="fileCount"></p>

<!-- Modal -->
<div id="pdfModal">
  <div class="pdf-viewer">
    <button class="close-btn" onclick="closePDF()">‚úñ</button>
    <iframe id="pdfFrame"></iframe>
  </div>
</div>

<script>
  const apiKey = "AIzaSyA1GEi8WL-ztLznZSP6y1qfPKyImhAPVuU";
  const folderId = new URLSearchParams(window.location.search).get("folder");
  if (!folderId) {
    document.body.innerHTML = "<h3 style='text-align:center;color:red;'>‚ùå Add ?folder=YOUR_FOLDER_ID in URL</h3>";
  } else {
    loadFiles(folderId);
  }

  let allFiles = [];
  let gridView = true;

  async function loadFiles(folderId) {
    const container = document.getElementById("fileContainer");
    container.innerHTML = "<div class='loader'>Loading files...</div>";

    try {
      const res = await fetch(`https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&fields=files(id,name,mimeType,modifiedTime,webViewLink)&key=${apiKey}`);
      const data = await res.json();
      allFiles = data.files || [];
      renderFiles(allFiles);
    } catch (err) {
      container.innerHTML = "<p style='color:red;text-align:center;'>Error loading files.</p>";
    }
  }

  function renderFiles(files) {
    const container = document.getElementById("fileContainer");
    const count = document.getElementById("fileCount");
    container.innerHTML = "";
    count.textContent = `${files.length} file(s)`;

    if (!files.length) {
      container.innerHTML = "<p style='text-align:center;'>No files found.</p>";
      return;
    }

    files.forEach(file => {
      const fileIcon = file.mimeType.includes("pdf") ? "pdf-2"
                    : file.mimeType.includes("image") ? "image-file"
                    : file.mimeType.includes("video") ? "video-file"
                    : "document";

      const div = document.createElement("div");
      div.className = "file";
      div.innerHTML = `
        <button class="copy-btn" title="Copy link" onclick="copyLink('${file.webViewLink}')">üîó</button>
        <img src="https://img.icons8.com/fluency/96/${fileIcon}.png">
        <h4>${file.name}</h4>
        <button class="view-btn" onclick="viewPDF('${file.id}')">View</button>
      `;
      container.appendChild(div);
    });
    container.className = gridView ? "grid" : "list";
  }

  function viewPDF(id) {
    document.getElementById("pdfModal").style.display = "flex";
    document.getElementById("pdfFrame").src = `https://drive.google.com/file/d/${id}/preview`;
  }

  function closePDF() {
    document.getElementById("pdfModal").style.display = "none";
    document.getElementById("pdfFrame").src = "";
  }

  function copyLink(link) {
    navigator.clipboard.writeText(link);
    alert("‚úÖ Link copied!");
  }

  document.getElementById("searchBox").addEventListener("input", e => {
    const term = e.target.value.toLowerCase();
    const filtered = allFiles.filter(f => f.name.toLowerCase().includes(term));
    renderFiles(filtered);
  });

  document.getElementById("sortSelect").addEventListener("change", e => {
    const val = e.target.value;
    let sorted = [...allFiles];
    if (val === "az") sorted.sort((a, b) => a.name.localeCompare(b.name));
    else if (val === "za") sorted.sort((a, b) => b.name.localeCompare(a.name));
    else sorted.sort((a, b) => new Date(b.modifiedTime) - new Date(a.modifiedTime));
    renderFiles(sorted);
  });

  document.getElementById("toggleViewBtn").addEventListener("click", () => {
    gridView = !gridView;
    document.getElementById("toggleViewBtn").textContent = gridView ? "üî≥ Grid" : "üìã List";
    renderFiles(allFiles);
  });
</script>

</body>
</html>