<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title></title>
<style>
:root{
  --primary:#2563eb;
  --accent:#9333ea;
  --bg:#f1f5f9;
  --text:#1e293b;
  --card:#fff;
}
body.dark{
  --primary:#60a5fa;
  --accent:#c084fc;
  --bg:#0f172a;
  --text:#f8fafc;
  --card:#1e293b;
}

body{
  margin:0;
  font-family:"Poppins",sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:background .3s,color .3s;
}

/* Header */
header{
  background:linear-gradient(90deg,var(--primary),var(--accent));
  color:#fff;
  text-align:center;
  padding:16px;
  font-weight:600;
  font-size:18px;
  box-shadow:0 4px 14px rgba(0,0,0,0.1);
}

/* Top Controls */
.topbar{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
  padding:14px;
}
.search input{
  padding:10px 14px;
  border-radius:8px;
  border:1px solid #dbeafe;
  font-size:14px;
  outline:none;
  width:200px;
  background:var(--card);
  color:var(--text);
}
select{
  padding:9px 12px;
  border-radius:8px;
  border:1px solid #dbeafe;
  font-size:14px;
  background:var(--card);
  color:var(--text);
}
.toggle{
  background:var(--card);
  border:none;
  border-radius:8px;
  padding:8px 12px;
  cursor:pointer;
  font-weight:600;
  color:var(--text);
}

/* Grid Layout */
.grid-container{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:16px;
  padding:14px;
  animation:fadeIn .4s ease;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(20px);}
  to{opacity:1;transform:translateY(0);}
}

/* Card */
.card{
  background:var(--card);
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
  transition:transform .25s, box-shadow .25s;
  cursor:pointer;
  position:relative;
}
.card:hover{
  transform:translateY(-5px);
  box-shadow:0 8px 20px rgba(0,0,0,0.15);
}
.thumb{
  height:120px;
  background:#eef2ff;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.card-body{
  padding:10px;
}
.card h4{
  margin:0;
  font-size:14px;
  font-weight:600;
  color:var(--primary);
  text-overflow:ellipsis;
  overflow:hidden;
  white-space:nowrap;
}
.card p{
  font-size:12px;
  color:#64748b;
  margin-top:4px;
}

/* Floating Buttons */
.fab{
  position:fixed;
  bottom:20px;
  right:20px;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:1000;
}
.fab button{
  border:none;
  padding:12px;
  border-radius:50%;
  background:linear-gradient(45deg,var(--primary),var(--accent));
  color:#fff;
  font-size:16px;
  cursor:pointer;
  box-shadow:0 4px 14px rgba(0,0,0,0.2);
  transition:transform .3s;
}
.fab button:hover{
  transform:scale(1.1);
}

/* Fullscreen Viewer */
#viewer{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  z-index:2000;
  align-items:center;
  justify-content:center;
}
#viewer iframe{
  width:90%;
  height:90%;
  border:0;
  background:#fff;
  border-radius:8px;
}
#closeViewer{
  position:absolute;
  top:20px;
  right:20px;
  background:#ef4444;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:8px 14px;
  cursor:pointer;
}

/* Responsive */
@media(max-width:900px){
  .grid-container{grid-template-columns:repeat(2,1fr);}
}
@media(max-width:600px){
  .grid-container{grid-template-columns:repeat(1,1fr);}
  .thumb{height:160px;}
}
</style>
</head>
<body>

<header>JKBose Helper By Aabid</header>

<div class="topbar">
  <div class="search">
    <input id="searchBox" type="text" placeholder="Search files...">
  </div>
  <select id="filterType">
    <option value="all">All</option>
    <option value="folder">Folders</option>
    <option value="pdf">PDFs</option>
    <option value="image">Images</option>
  </select>
  <button class="toggle" id="modeToggle">üåô</button>
</div>

<div id="breadcrumb" style="text-align:center;font-size:13px;color:#64748b;">Home</div>

<div id="fileContainer" class="grid-container">
  <div style="grid-column:span 3;text-align:center;color:#64748b;">Loading...</div>
</div>

<div class="fab">
  <button id="backBtn" title="Go Back">‚¨Ö</button>
  <button id="homeBtn" title="Home">üè†</button>
</div>

<!-- Viewer -->
<div id="viewer">
  <button id="closeViewer">‚úñ Close</button>
  <iframe id="pdfViewer"></iframe>
</div>

<script>
const apiKey = "AIzaSyA1GEi8WL-ztLznZSP6y1qfPKyImhAPVuU";
let currentFolder = new URLSearchParams(window.location.search).get("folder");
if(!currentFolder){
  document.getElementById("fileContainer").innerHTML="<div style='grid-column:span 3;text-align:center;'>Add ?folder=FOLDER_ID to URL</div>";
  throw new Error("No folder id");
}
let folderStack=[], allFiles=[];

const container=document.getElementById("fileContainer");
const breadcrumb=document.getElementById("breadcrumb");
const searchBox=document.getElementById("searchBox");
const filterType=document.getElementById("filterType");
const viewer=document.getElementById("viewer");
const pdfViewer=document.getElementById("pdfViewer");
const closeViewer=document.getElementById("closeViewer");
const modeToggle=document.getElementById("modeToggle");
const backBtn=document.getElementById("backBtn");
const homeBtn=document.getElementById("homeBtn");

/* Load Folder */
async function loadFolder(id,name="Home"){
  breadcrumb.textContent=name;
  container.innerHTML="<div style='grid-column:span 3;text-align:center;'>Loading...</div>";
  try{
    const url=`https://www.googleapis.com/drive/v3/files?q='${id}'+in+parents+and+trashed=false&fields=files(id,name,mimeType,thumbnailLink)&key=${apiKey}`;
    const res=await fetch(url);
    const data=await res.json();
    allFiles=data.files||[];
    renderGrid(allFiles);
  }catch(e){
    container.innerHTML="<div style='grid-column:span 3;text-align:center;color:red;'>Error loading folder</div>";
  }
}

/* Render */
function renderGrid(files){
  const q=searchBox.value.toLowerCase();
  const f=filterType.value;
  const filtered=files.filter(x=>{
    const type=getType(x.mimeType);
    return (!q||x.name.toLowerCase().includes(q))&&(f==="all"||f===type);
  });
  container.innerHTML="";
  if(filtered.length===0){container.innerHTML="<div style='grid-column:span 3;text-align:center;'>No items</div>";return;}
  filtered.forEach(file=>{
    const type=getType(file.mimeType);
    const card=document.createElement("div");
    card.className="card";
    const img=getThumb(file,type);
    card.innerHTML=`
      <div class="thumb"><img src="${img}" alt="${file.name}"></div>
      <div class="card-body"><h4>${file.name}</h4><p>${type.toUpperCase()}</p></div>`;
    card.onclick=()=>openItem(file,type);
    container.appendChild(card);
  });
}

/* Helpers */
function getType(mime){
  if(mime==="application/vnd.google-apps.folder")return"folder";
  if(mime.includes("pdf"))return"pdf";
  if(mime.startsWith("image/"))return"image";
  return"file";
}
function getThumb(f,type){
  if(type==="folder")return"data:image/svg+xml;utf8,"+encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 80'><rect width='100' height='80' rx='10' fill='#bfdbfe'/><text x='50' y='50' font-size='40' text-anchor='middle'>üìÅ</text></svg>`);
  if(type==="pdf")return"data:image/svg+xml;utf8,"+encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 80'><rect width='100' height='80' rx='10' fill='#fecaca'/><text x='50' y='50' font-size='40' text-anchor='middle'>üìÑ</text></svg>`);
  if(type==="image")return f.thumbnailLink||`https://drive.google.com/uc?id=${f.id}`;
  return f.thumbnailLink||"https://via.placeholder.com/100";
}

/* Open item */
function openItem(file,type){
  if(type==="folder"){folderStack.push(currentFolder);currentFolder=file.id;loadFolder(file.id,file.name);return;}
  viewer.style.display="flex";
  pdfViewer.src=`https://drive.google.com/file/d/${file.id}/preview`;
}

/* Back + Home */
backBtn.onclick=()=>{
  if(folderStack.length>0){
    currentFolder=folderStack.pop();
    loadFolder(currentFolder,"Back");
  }
};
homeBtn.onclick=()=>{location.href=location.pathname+"?folder="+(new URLSearchParams(window.location.search).get("folder"));};

/* Close viewer */
closeViewer.onclick=()=>{viewer.style.display="none";pdfViewer.src="";};

/* Search + Filter */
searchBox.oninput=()=>renderGrid(allFiles);
filterType.onchange=()=>renderGrid(allFiles);

/* Dark Mode */
if(localStorage.getItem("theme")==="dark"){document.body.classList.add("dark");modeToggle.textContent="‚òÄÔ∏è";}
modeToggle.onclick=()=>{
  document.body.classList.toggle("dark");
  const dark=document.body.classList.contains("dark");
  modeToggle.textContent=dark?"‚òÄÔ∏è":"üåô";
  localStorage.setItem("theme",dark?"dark":"light");
};

/* Start */
loadFolder(currentFolder);
</script>
</body>
</html>