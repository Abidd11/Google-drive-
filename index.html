<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Drive Media Explorer ‚Äî Updated Icons</title>
<style>
  :root{
    --primary:#2563eb;
    --accent:#9333ea;
    --bg:#f1f5f9;
    --card-bg:#fff;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Poppins", "Segoe UI", Roboto, Arial, sans-serif;
    background:var(--bg);
    color:#102a43;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  header{
    background: linear-gradient(90deg,var(--primary),var(--accent));
    color:#fff;
    padding:18px;
    text-align:center;
    font-weight:600;
    font-size:18px;
    box-shadow:0 4px 14px rgba(16,42,67,0.12);
  }

  .topbar{
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:center;
    padding:12px 16px;
  }
  .search{
    width:100%;
    max-width:560px;
    display:flex;
    gap:8px;
  }
  .search input{
    flex:1;
    padding:10px 14px;
    border-radius:28px;
    border:1px solid #dbeafe;
    box-shadow:0 6px 18px rgba(37,99,235,0.06);
    outline:none;
    font-size:14px;
  }
  .breadcrumb{
    text-align:center;
    color:#64748b;
    font-size:13px;
    margin-bottom:6px;
  }
  .centered{
    max-width:1180px;
    margin:10px auto;
    padding:0 12px;
  }

  /* grid - 3 columns default */
  .grid-container{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:16px;
    margin-top:8px;
  }

  /* card */
  .card{
    background:var(--card-bg);
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 6px 18px rgba(16,42,67,0.06);
    transition:transform .28s ease, box-shadow .28s ease;
    cursor:pointer;
    position:relative;
    display:flex;
    flex-direction:column;
    min-height:170px;
    border:1px solid rgba(16,42,67,0.04);
  }
  .card:hover{
    transform:translateY(-6px);
    box-shadow:0 12px 30px rgba(16,42,67,0.12);
  }

  /* thumbnail area */
  .thumb{
    position:relative;
    height:120px;
    background:#eef2ff;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
  }
  .thumb img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  /* small badge icons (fixed small size) */
  .type-badge{
    position:absolute;
    top:10px;
    left:10px;
    height:28px;
    min-width:28px;
    padding:4px 6px;
    border-radius:999px;
    background:rgba(255,255,255,0.9);
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-size:16px;
    box-shadow:0 3px 8px rgba(2,6,23,0.08);
    color:#0f172a;
    border:1px solid rgba(16,42,67,0.06);
    pointer-events:none;
  }
  .pdf-badge{
    position:absolute;
    top:10px;
    right:10px;
    height:28px;
    min-width:28px;
    padding:4px 6px;
    border-radius:999px;
    background:rgba(255,255,255,0.95);
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-size:14px;
    box-shadow:0 3px 8px rgba(2,6,23,0.08);
    color:#c02628;
    border:1px solid rgba(16,42,67,0.05);
    pointer-events:none;
  }

  .card-body{
    padding:10px 12px 14px;
    flex:1;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
  }
  .title{
    font-size:14px;
    font-weight:600;
    color:var(--primary);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .meta{
    font-size:12px;
    color:#475569;
    margin-top:6px;
    display:flex;
    gap:8px;
    align-items:center;
  }

  /* viewer full screen */
  #viewer{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(5,10,26,0.9);
    z-index:1200;
    align-items:center;
    justify-content:center;
    padding:18px;
  }
  #viewer .viewer-card{
    width:96%;
    height:92%;
    background:#fff;
    border-radius:12px;
    overflow:hidden;
    position:relative;
    display:flex;
    flex-direction:column;
  }
  #viewer iframe{
    width:100%;
    height:100%;
    border:0;
    background:#fff;
  }
  .viewer-close{
    position:absolute;
    top:12px;
    right:12px;
    z-index:5;
    background:#ef4444;
    color:#fff;
    border:0;
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    font-weight:700;
  }

  /* no-download overlay note (for sketchware usage) */
  .viewer-note{
    position:absolute;
    left:12px;
    top:12px;
    background:rgba(0,0,0,0.06);
    padding:6px 10px;
    border-radius:8px;
    font-size:12px;
    color:#042a48;
  }

  /* responsive */
  @media(max-width:1000px){
    .grid-container{grid-template-columns:repeat(2,1fr)}
  }
  @media(max-width:600px){
    .grid-container{grid-template-columns:repeat(1,1fr)}
    .thumb{height:140px}
  }
</style>
</head>
<body>

<header>üìÅ Drive Media Explorer</header>

<div class="centered">
  <div class="topbar">
    <div class="search">
      <input id="searchBox" type="text" placeholder="Search files & folders..." />
    </div>
  </div>
  <div class="breadcrumb" id="breadcrumb">Home</div>

  <div id="fileContainer" class="grid-container">
    <!-- cards injected here -->
    <div style="grid-column:span 3;text-align:center;color:#64748b;padding:24px">Loading‚Ä¶</div>
  </div>
</div>

<!-- FULLSCREEN VIEWER -->
<div id="viewer">
  <div class="viewer-card" role="dialog" aria-modal="true">
    <button class="viewer-close" id="closeViewer">‚úñ Close</button>
    <div class="viewer-note">Preview (download disabled in-app)</div>
    <iframe id="pdfViewer" src=""></iframe>
  </div>
</div>

<script>
/* ---------- CONFIG ---------- */
const apiKey = "AIzaSyA1GEi8WL-ztLznZSP6y1qfPKyImhAPVuU"; // user-provided
let currentFolder = new URLSearchParams(window.location.search).get("folder");
if(!currentFolder){
  document.getElementById('fileContainer').innerHTML = '<div style="grid-column:span 3;text-align:center;color:#c2410c;padding:24px">Add ?folder=FOLDER_ID to URL</div>';
  throw new Error('Missing folder id in URL');
}

/* ---------- helpers ---------- */
const container = document.getElementById('fileContainer');
const searchBox = document.getElementById('searchBox');
const breadcrumb = document.getElementById('breadcrumb');
const viewer = document.getElementById('viewer');
const pdfViewer = document.getElementById('pdfViewer');
const closeViewer = document.getElementById('closeViewer');

let allFiles = [];
let folderStack = [];

/* small SVG thumbnails as data-urls for pdf/folder (keeps cards consistent when Drive thumbnails are absent) */
const folderThumb = 'data:image/svg+xml;utf8,' + encodeURIComponent(
  `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 400'>
    <rect width='100%' height='100%' rx='20' fill='#dbeafe'/>
    <text x='50%' y='55%' text-anchor='middle' font-family='system-ui, Arial' font-size='72' fill='#1d4ed8'>üìÅ</text>
  </svg>`
);
const pdfThumb = 'data:image/svg+xml;utf8,' + encodeURIComponent(
  `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 400'>
    <rect width='100%' height='100%' rx='20' fill='#fee2e2'/>
    <text x='50%' y='55%' text-anchor='middle' font-family='system-ui, Arial' font-size='72' fill='#b91c1c'>üìÑ</text>
  </svg>`
);
const docThumb = 'data:image/svg+xml;utf8,' + encodeURIComponent(
  `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 400'>
    <rect width='100%' height='100%' rx='20' fill='#fff7ed'/>
    <text x='50%' y='55%' text-anchor='middle' font-family='system-ui, Arial' font-size='64' fill='#b45309'>üìÑ</text>
  </svg>`
);

/* detect type */
function detectType(mime){
  if(!mime) return 'other';
  if(mime === 'application/vnd.google-apps.folder') return 'folder';
  if(mime.includes('pdf')) return 'pdf';
  if(mime.startsWith('image/')) return 'image';
  return 'other';
}

/* thumbnail fallback */
function thumbnailFor(file, type){
  if(type === 'folder') return folderThumb;
  if(type === 'pdf') return pdfThumb;
  if(type === 'image'){
    // use Drive thumbnailLink if present else direct public link
    if(file.thumbnailLink) return file.thumbnailLink;
    return `https://drive.google.com/uc?id=${file.id}`;
  }
  return file.thumbnailLink || docThumb;
}

/* render grid */
function renderGrid(files){
  const q = searchBox.value.trim().toLowerCase();
  const filtered = files.filter(f => !q || f.name.toLowerCase().includes(q));
  container.innerHTML = '';
  if(filtered.length === 0){
    container.innerHTML = '<div style="grid-column:span 3;text-align:center;color:#64748b;padding:24px">No items found.</div>';
    return;
  }

  filtered.forEach(f => {
    const type = detectType(f.mimeType);
    const thumb = thumbnailFor(f,type);

    const card = document.createElement('article');
    card.className = 'card';
    card.innerHTML = `
      <div class="thumb">
        <img loading="lazy" src="${thumb}" alt="${escapeHtml(f.name)}" />
        <span class="type-badge">${typeBadgeEmoji(type)}</span>
        ${ type === 'pdf' ? `<span class="pdf-badge">PDF</span>` : '' }
      </div>
      <div class="card-body">
        <div class="title">${escapeHtml(f.name)}</div>
        <div class="meta">${typeLabel(type)}</div>
      </div>
    `;
    card.addEventListener('click', () => openItem(f, type));
    container.appendChild(card);
  });
}

/* small emoji badges */
function typeBadgeEmoji(type){
  if(type === 'folder') return 'üìÅ';
  if(type === 'pdf') return 'üìï';
  if(type === 'image') return 'üñºÔ∏è';
  return 'üìÑ';
}
function typeLabel(type){
  if(type === 'folder') return 'Folder';
  if(type === 'pdf') return 'PDF Document';
  if(type === 'image') return 'Image';
  return 'File';
}

/* open item: folder navigates, pdf/image previews */
function openItem(file, type){
  if(type === 'folder'){
    // push current folder to stack
    folderStack.push({id: currentFolder, name: breadcrumb.textContent || 'Home'});
    currentFolder = file.id;
    loadFolder(file.id, file.name);
    return;
  }

  // open viewer fullscreen (using drive preview)
  viewer.style.display = 'flex';
  if(type === 'pdf'){
    // Use drive preview endpoint (no direct download button in-app)
    pdfViewer.src = `https://drive.google.com/file/d/${file.id}/preview`;
  }else if(type === 'image'){
    // open image in iframe to fit; use drive direct view if thumbnail missing
    pdfViewer.src = file.thumbnailLink || `https://drive.google.com/uc?id=${file.id}`;
  }else{
    // generic - try drive preview
    pdfViewer.src = `https://drive.google.com/file/d/${file.id}/preview`;
  }
}

/* go back */
function goBack(){
  const prev = folderStack.pop();
  if(!prev){
    // if stack empty, reload root
    loadFolder(currentFolder, 'Home');
    return;
  }
  currentFolder = prev.id;
  loadFolder(prev.id, prev.name);
}

/* load folder via Drive v3 files list (children) */
async function loadFolder(folderId, name='Home'){
  breadcrumb.textContent = name || 'Home';
  container.innerHTML = '<div style="grid-column:span 3;text-align:center;color:#64748b;padding:24px">Loading‚Ä¶</div>';
  try{
    const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents+and+trashed=false&fields=files(id,name,mimeType,thumbnailLink,webContentLink,webViewLink)&key=${apiKey}`;
    const res = await fetch(url);
    const json = await res.json();
    allFiles = json.files || [];
    renderGrid(allFiles);
  }catch(err){
    container.innerHTML = `<div style="grid-column:span 3;text-align:center;color:#c2410c;padding:24px">Error loading folder: ${escapeHtml(err.message||err)}</div>`;
    console.error(err);
  }
}

/* search */
searchBox.addEventListener('input', () => renderGrid(allFiles));

/* viewer controls */
closeViewer.addEventListener('click', () => {
  viewer.style.display = 'none';
  pdfViewer.src = '';
});

/* utility */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* initial load */
loadFolder(currentFolder, 'Home');

</script>
</body>
</html>