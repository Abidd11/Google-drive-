<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JKBose Helper</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
/* --- 1. Root Variables & New Colors --- */
:root{
  --primary: #1B2E8D; /* Deep Indigo - Header, FAB */
  --accent: #A855F7; /* Violet (kept for gradient consistency) */
  --bg: #E6E6F2;     /* Light Lavender - Main Background */
  --card: #FFFFFF;   /* White - Cards */
  --card-bg-light: #C5CAE8; /* Medium Lavender - Used for subtle depth */
  --text: #1f2937;
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
  --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.2);
}
body.dark{
  --primary: #60a5fa;
  --accent: #c084fc;
  --bg: #1f2937;
  --card: #374151;
  --card-bg-light: #4b5563;
  --text: #f3f4f6;
}

/* --- 2. Base Styles --- */
body{
  margin:0;
  font-family: 'Poppins', sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:background .4s ease,color .4s ease;
}

/* --- 3. Header --- */
header{
  background:var(--primary);
  color:#fff;
  text-align:center;
  padding:20px 16px; /* Increased padding */
  font-weight:700;
  font-size:22px;
  box-shadow:0 3px 10px rgba(0,0,0,0.2);
  letter-spacing:1px;
}

/* --- 4. Top Controls (Topbar) --- */
.topbar{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:12px;
  padding:16px 20px;
  background:var(--card);
  box-shadow:var(--shadow-sm);
  margin-bottom: 15px;
}
.search input, select{
  padding:12px 18px; /* Larger touch targets */
  border-radius:12px;
  border:none; /* Removed border */
  background:var(--card-bg-light); /* New input background color */
  font-size:14px;
  outline:none;
  width:100%; /* Default to full width for mobile */
  max-width:250px;
  color:var(--text);
  transition:all .3s;
}
.search input:focus, select:focus{
  background:var(--card);
  box-shadow:0 0 0 3px var(--primary); /* Focus ring effect */
}
select{
  width: auto;
  min-width: 140px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  padding-right: 35px;
  background: var(--card-bg-light) url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='gray'><path fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /></svg>") no-repeat right 10px center;
  background-size: 18px;
}
.toggle{
  background:var(--card-bg-light);
  border:none;
  border-radius:12px;
  padding:10px 16px;
  cursor:pointer;
  font-weight:600;
  color:var(--text);
  transition:background .3s, transform .2s;
}
.toggle:hover{
  background:var(--primary);
  color:#fff;
  transform: translateY(-1px);
}

/* Breadcrumb Styling */
#breadcrumb{
  padding: 10px 20px;
  font-size:14px !important;
  color:#4b5563 !important;
  font-weight: 500;
  text-align: left !important;
}

/* --- 5. Grid Layout and Animation --- */
.grid-container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); /* Better mobile column sizing */
  gap:20px;
  padding:20px;
}
.card{
  animation:fadeInUp .4s ease backwards;
}

@keyframes fadeInUp{
  from{opacity:0;transform:translateY(20px);}
  to{opacity:1;transform:translateY(0);}
}

/* --- 6. Card Styles and Interactions --- */
.card{
  background:var(--card);
  border-radius:16px; /* More rounded */
  box-shadow:var(--shadow-md);
  transition:transform .3s ease, box-shadow .3s ease;
  cursor:pointer;
  overflow:hidden;
}
.card:hover{
  transform:translateY(-10px) scale(1.02); /* More aggressive lift */
  box-shadow:var(--shadow-lg);
}
.thumb{
  height:160px; /* Taller on mobile screens */
  background:var(--card-bg-light);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
  transition: transform 0.4s ease;
}
.card:hover .thumb img{
  transform: scale(1.05);
}
.card-body{
  padding:15px;
}
.card h4{
  margin:0;
  font-size:16px;
  font-weight:700;
  color:var(--primary); /* Title color is the deep indigo */
  text-overflow:ellipsis;
  overflow:hidden;
  white-space:nowrap;
}
.card p{
  font-size:13px;
  color:#6b7280;
  margin-top:4px;
  font-weight: 500;
}

/* --- 7. Floating Action Buttons (FAB) --- */
.fab{
  position:fixed;
  bottom:20px;
  right:20px;
  display:flex;
  flex-direction:column;
  gap:12px;
  z-index:1000;
}
.fab button{
  border:none;
  padding:16px; /* Larger FAB */
  border-radius:50%;
  background:var(--primary); /* Solid primary color */
  color:#fff;
  font-size:20px;
  cursor:pointer;
  box-shadow:0 6px 16px rgba(27, 46, 141, 0.4);
  transition:transform .3s ease, box-shadow .3s ease;
}
.fab button:hover{
  transform:scale(1.15) rotate(5deg);
}

/* --- 8. Viewer Animation --- */
#viewer{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.95);
  z-index:2000;
  align-items:center;
  justify-content:center;
  opacity: 0;
  transition: opacity .3s ease;
}
#viewer.active{
    display:flex;
    opacity: 1;
}
#viewer iframe{
  width:95%;
  max-width: 1200px; /* Wider viewer */
  height:95%;
  max-height: 900px;
  border:0;
  background:var(--card);
  border-radius:10px;
  box-shadow:0 0 30px rgba(0,0,0,0.5);
  transform: scale(0.95);
  transition: transform .3s ease;
}
#viewer.active iframe{
    transform: scale(1);
}
/* Updated Close/Back button style and text */
#closeViewer{
  position:absolute;
  top:20px;
  right:20px;
  background:var(--primary); /* Use Primary color for 'Back' button */
  color:#fff;
  border:none;
  border-radius:6px;
  padding:10px 16px;
  cursor:pointer;
  font-weight: 600;
  opacity: 0.9;
  transition: opacity .2s, background .3s;
  display: flex;
  align-items: center;
  gap: 5px;
}
#closeViewer:hover{
    opacity: 1;
    background: #0e1e69; /* Slightly darker primary on hover */
}

/* --- 9. Responsive adjustments for larger screens --- */
@media(min-width: 768px) {
  .topbar{justify-content: space-between; max-width: 900px; margin: 0 auto 15px;}
  .search input {max-width: 300px;}
  .grid-container{max-width: 900px; margin: 0 auto;}
  .toggle {padding: 10px 20px;}
}
@media(max-width: 600px){
  .grid-container{grid-template-columns:repeat(auto-fit,minmax(140px,1fr));}
  .search input, select, .toggle{max-width: 100%;} /* Ensure full width on smallest screens */
  .fab button {padding: 12px; font-size: 18px;}
}
</style>
</head>
<body>

<header>JKBose Helper</header>

<div class="topbar">
  <div class="search">
    <input id="searchBox" type="text" placeholder="Search files...">
  </div>
  <select id="filterType">
    <option value="all">All</option>
    <option value="folder">Folders</option>
    <option value="pdf">PDFs</option>
    <option value="image">Images</option>
  </select>
  <button class="toggle" id="modeToggle">üåô</button>
</div>

<div id="breadcrumb">Home</div>

<div id="fileContainer" class="grid-container">
  <div style="grid-column:span all;text-align:center;color:#4b5563;padding: 20px;">Loading...</div>
</div>

<div class="fab">
  <button id="backBtn" title="Go Back">‚¨Ö</button>
  <button id="homeBtn" title="Home">üè†</button>
</div>

<div id="viewer">
  <button id="closeViewer">
    <span style="font-size: 1.2em;">&larr;</span> Back
  </button>
  <iframe id="pdfViewer"></iframe>
</div>

<script>
const apiKey = "AIzaSyA1GEi8WL-ztLznZSP6y1qfPKyImhAPVuU";
let currentFolder = new URLSearchParams(window.location.search).get("folder");
if(!currentFolder){
  document.getElementById("fileContainer").innerHTML="<div style='grid-column:span all;text-align:center;padding: 20px;'>Add ?folder=FOLDER_ID to URL</div>";
  throw new Error("No folder id");
}
let folderStack=[], allFiles=[];

const container=document.getElementById("fileContainer");
const breadcrumb=document.getElementById("breadcrumb");
const searchBox=document.getElementById("searchBox");
const filterType=document.getElementById("filterType");
const viewer=document.getElementById("viewer");
const pdfViewer=document.getElementById("pdfViewer");
const closeViewer=document.getElementById("closeViewer");
const modeToggle=document.getElementById("modeToggle");
const backBtn=document.getElementById("backBtn");
const homeBtn=document.getElementById("homeBtn");

/* Load Folder */
async function loadFolder(id,name="Home"){
  breadcrumb.textContent=name;
  container.innerHTML="<div style='grid-column:span all;text-align:center;padding: 20px;'>Loading...</div>";
  try{
    const url=`https://www.googleapis.com/drive/v3/files?q='${id}'+in+parents+and+trashed=false&fields=files(id,name,mimeType,thumbnailLink)&key=${apiKey}`;
    const res=await fetch(url);
    const data=await res.json();
    allFiles=data.files||[];
    renderGrid(allFiles);
  }catch(e){
    container.innerHTML="<div style='grid-column:span all;text-align:center;color:red;padding: 20px;'>Error loading folder</div>";
  }
}

/* Render */
function renderGrid(files){
  const q=searchBox.value.toLowerCase();
  const f=filterType.value;
  const filtered=files.filter(x=>{
    const type=getType(x.mimeType);
    return (!q||x.name.toLowerCase().includes(q))&&(f==="all"||f===type);
  });
  container.innerHTML="";
  if(filtered.length===0){container.innerHTML="<div style='grid-column:span all;text-align:center;padding: 20px;'>No items found matching your criteria.</div>";return;}
  
  // Set the container to display the files
  filtered.forEach((file, index)=>{
    const type=getType(file.mimeType);
    const card=document.createElement("div");
    card.className="card";
    // Apply animation delay stagger for a smoother loading effect
    card.style.animationDelay = `${index * 0.05}s`;
    
    const img=getThumb(file,type);
    card.innerHTML=`
      <div class="thumb"><img src="${img}" alt="${file.name}"></div>
      <div class="card-body"><h4>${file.name}</h4><p>${type.toUpperCase()}</p></div>`;
    card.onclick=()=>openItem(file,type);
    container.appendChild(card);
  });
}

/* Helpers */
function getType(mime){
  if(mime==="application/vnd.google-apps.folder")return"folder";
  if(mime.includes("pdf"))return"pdf";
  if(mime.startsWith("image/"))return"image";
  return"file";
}
function getThumb(f,type){
  // Updated SVG colors to match the new light palette
  if(type==="folder")return"data:image/svg+xml;utf8,"+encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 80'><rect width='100' height='80' rx='10' fill='#C5CAE8'/><text x='50' y='50' font-size='40' text-anchor='middle'>üìÅ</text></svg>`);
  if(type==="pdf")return"data:image/svg+xml;utf8,"+encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 80'><rect width='100' height='80' rx='10' fill='#C5CAE8'/><text x='50' y='50' font-size='40' text-anchor='middle'>üìÑ</text></svg>`);
  if(type==="image")return f.thumbnailLink||`https://drive.google.com/uc?id=${f.id}`;
  return f.thumbnailLink||"https://via.placeholder.com/140?text=File";
}

/* Open item - Fixed PDF Viewer with the Docs Viewer URL */
function openItem(file,type){
  if(type==="folder"){folderStack.push(currentFolder);currentFolder=file.id;loadFolder(file.id,file.name);return;}
  
  viewer.classList.add("active");
  
  if(type==="pdf"){
      // Uses Google Docs Viewer which is more reliable for embedding public PDFs.
      // NOTE: The target file on Google Drive MUST be publicly shared for this to work.
      pdfViewer.src=`https://docs.google.com/gview?url=https://drive.google.com/uc?id=${file.id}&embedded=true`;
  } else {
      // Use the standard Google Drive preview for other file types/images
      pdfViewer.src=`https://drive.google.com/file/d/${file.id}/preview`;
  }
}

/* Back + Home */
backBtn.onclick=()=>{
  if(folderStack.length>0){
    currentFolder=folderStack.pop();
    loadFolder(currentFolder,"Back");
  }
};
homeBtn.onclick=()=>{location.href=location.pathname+"?folder="+(new URLSearchParams(window.location.search).get("folder"));};

/* Close viewer */
closeViewer.onclick=()=>{viewer.classList.remove("active");pdfViewer.src="";};

/* Search + Filter */
searchBox.oninput=()=>renderGrid(allFiles);
filterType.onchange=()=>renderGrid(allFiles);

/* Dark Mode */
if(localStorage.getItem("theme")==="dark"){document.body.classList.add("dark");modeToggle.textContent="‚òÄÔ∏è";}
modeToggle.onclick=()=>{
  document.body.classList.toggle("dark");
  const dark=document.body.classList.contains("dark");
  modeToggle.textContent=dark?"‚òÄÔ∏è":"üåô";
  localStorage.setItem("theme",dark?"dark":"light");
};

/* Start */
loadFolder(currentFolder);
</script>
</body>
</html>
